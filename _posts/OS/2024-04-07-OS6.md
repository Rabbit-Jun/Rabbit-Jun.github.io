---
title: "컴퓨터 성능 향상 기술"
layout: post
date: 2024-04-07
categories: OS
---
# 버퍼(buffer)
- 속도에 차이가 있는 두 장치 사이에서 그 차이를 완화하는 역할을 하는 장치( 메모리 내 임시 공간)
- 일정량의 데이터를 모아 옮김으로써 속도의 차이를 완화
![buffer](/assets/osimg/buffer.png)
- **하드디스크에 메모리 버퍼가 있음**
- **버퍼가 소프트웨어에서 사용되는 예: 동영상 스트리밍**
- **모니터 버퍼 : C 언어의 출력문인 print("hello \n")에서 \n은 줄바꿈의 의미도 있지만 버퍼에 저장된 내용을 출력하라는 의미도 있다**

# 스풀 (SPOOL; Simulataneous Peripheral Operation On-Line)
- CPU와 입출력장치가 독립적으로 동작하도록 고안된 **소프트웨어적인 버퍼**
- ex) **스풀러(spooler)**
    - 인쇄할 내용을 순차적으로 출력하는 소프트웨어로 출력 명령을 내린 프로그램과 독립적으로 동작
    - 인쇄물이 완료될 때까지 다른 인쇄물이 끼어들 수 없으므로 프로그램 간에 배타적임
    ![principle](/assets/osimg/principle2.png)
    - 하드웨어 안전 제거
        -버퍼를 사용하면 버퍼가 채워질 때까지 저장장치 간의 데이터 전송이 지연된다.
            - 외부저장 장치따위를 사용하여 데이터를 복사 했을 때 저장된 것처럼 보여도 아직 저장되지 않은 데이터 있을 수 있음 (갑자기 컴퓨터 전원 끄는 것 등)
        - 하드웨어 안전 제거를 사용하면 버퍼에 있는 아직 옮겨지지 않는 데이터를 저장장치로 보낸다.

# 캐시 (cache , cache memory)
- 메모리와 CPU 간의 속도 차이 (BSB와 FSB의 속도 차이)를 완화하기 위해 메모리의 데이터를 미리 가져와 저장해두는 임시 장소 (CPU 내부에 위치)
- 필요한 데이터를 모아 한꺼번에 전달하는 버퍼의 일종으로 CPU가 앞으로 사용할 것으로 예상되는 데이터를 미리 가져다 놓음
- CPU는 메모리에 접근해야 할 떄 캐시를 먼저 방문하여 원하는 데이터가 있는지 찾아봄

# 캐시의 구조
- 캐시 히트(cache hit): 캐시에서 원하는 데이터를 찾는 것으로, 그 데이터를 바로 사용
- 캐시 미스(cache miss): 캐시에 원하는 데이터가 없으면 메모리로 가서 찾음
- 캐시 적중률(cache hit ratio): 캐시 히트 되는 비율로 일반적인 컴퓨터의 캐시 적중률은 약 90%

![cache structure](/assets/osimg/cache_structure.png)

# 캐시 적중률을 높이는 방법
1. 캐시의 크기를 늘린다
2. 앞으로 많이 사용될 데이터를 가져 온다.
- ** 지역성 이론 (locality theory): 현재 위치에 가까운 데이터가 멀리 있는 데이터보다 사용될 확률이 높다**
- *프로그래밍 시 goto 문을 사용함ㄴ 다음 행이 실행될 것으로 예상되어 캐시에 미리 저장된 데이터가 쓸모가 없어진다*

# 캐시의 변경된 데이터를 메모리에 반영하는 방식 두 가지
- 즉시 쓰기(write through)
    -캐시에 있는 데이터가 변경되면 이를 즉시 메모리에 반영하는 방식
    - 메모리와의 빈번한 데이터 전송으로 인해 성능이 느려짐
    - 메모리의 최신 값이 항상 유지되기 때문에 급작스러운 정전에도 데이터를 잃어 버리지 않음
- 지연 쓰기(write back)
    - 캐시에 있는 데이터가 변경되면 이를 즉시 메모리에 반영하는 것이 아니라 변경된 내용을 모아서 주기적으로 반영하는 방식
    - **카피백(copy back)**이라고도 함
    - 메모리와의 데이터 전송 횟수가 줄어들어 시스템의 성능을 향상할 수 있음
    - 메모리와 캐시된 데이터 사이의 불일치가 발생할 수도 있음

# L1 캐시와 L2 캐시
- 캐시는 명령어와 데이터의 구분 없이 모든 자료를 가져오는 일반 캐시, 명령어와 데이터를 구분하여 가져오는 특수 캐시로 구분
- 일반 캐시: 메모리와 연결되기 때문에 L2(Level 2)캐시라고 부름
- 특수 캐시:CPU 레지스터에 직접 연결되므로 L1(Level 1)캐시라고 부름
![cache structure](/assets/osimg/cache_structure2.png)

# 저장장치의 계층 구조
- 개념
    - 속도가 빠르고 값이 비싼 저장장치를 CPU 가까운 쪽에 두고, 값이 싸고 용량이 큰 저장장치를 반대쪽에 배치해 적당한 가격으로 빠른 속도와 큰 용량을 동시에 얻는 방법
- 이점
    - CPU와 가까운 쪽에 레지스터나 캐시를 배치하여 CPU가 작업을 빨리 진행할 수 있음
    - 메모리에서 작업한 내용을 하드디스크와 같이 저렴하고 용량이 큰 저장장치에 영구적으로 저장할 수 있음
![layered structure](/assets/osimg/layered_structure2.png)

# 폴링(polling)방식
- CPU가 직접 입출력장치에서 데이터를 가져오거나 내보내는 방식 (초기 컴퓨터 시스템)
- CPU가 입출력장치의 상태를 주기적으로 검사하여 일정한 조건을 만족할 때 데이터를 처리
- CPU가 명령어 해석과 실행이라는 본래 역할 외에 모든 입출력까지 관여하므로 작업 효율 떨어짐

# 인터럽트(interrupt) 방식
- 입출력 관리자가 대신 입출력을 해주는 방식
- CPU의 작업과 저장장치의 데이터 이동을 독립적으로 운영함으로써 시스템의 효율을 높임
- 데이터의 입출력이 이루어지는 동안 CPU가 다른 작업을 할 수 있음

# 인터럽트 방식의 동작 과정
1. **[입출력 요청]** CPU가 입출려고간리자에게 입출력 명령을 내린다.
2. **[데이터 전송]** 입출력관리자는 명령받은 데이터를 메모리에 가져다 놓거나, 메모리에 있는 데이터를 저장장치에 옮긴다.
3. **[인터럽트 발생]** 데이터 전송이 완료되면 입출력관리자는 CPU에게 완료 신호 [인터럽트]를 보낸다.
    - **CPU는 하던 일을 중단하고 옮겨진 데이터를 처리한다**

### 인터럽트
    - 입출력 관리자가 CPU에 보내느 완료 신호

### 인터럽트 번호
    - 많은 주변장치 중 어떤 것의 작업이 끝났는지를 CPU에 알려주기 위해 사용하는 번호
    - 윈도우 운영체제에서는 IRQ라 부름

### 인터럽트 벡터
    - 여러 개의 입출력 작업을 한꺼번에 처리하기 위해 여러 개의 인터럽트를 하나의 배열로 만든 것

### 인터럽트 방식의 동작 과정
![processing](/assets/osimg/processing3.png)

# 다양한 종류의 인터럽트
1. **입출력 작업 완료시**
2. **컴퓨터 전원 버튼을 눌러서 강제 종료시**: CPU는 하던일을 모두 멈추고 처리 중인 데이터를 안전하게 보관한 뒤 시스템을 종료.
3. **실행중인 어떤 작업이 자신에게 주어진 메모리 영역을 넘어설 때**
4. **0으로 숫자를 나눌 때**

# 직접 메모리 접근(DIrect Memory Access; DMA)
- 입출력 관리자가 CPU의 허락 없이 메모리에 접근할 수 있는 권한
- 메모리는 CPU 작업 공간이지만, 데이터 전송을 지시받은 입추력 관리자는 직접 메모리 접근 권한이 있어야만 작업을 처리할 수 있음
![direc memory memory access structure](/assets/osimg/structure6.png)

# 메모리 맵 입출력(Memory Mapped I/O; MMIO)
    메모리의 일정 공간으 입출력에 할당하는 기법
![memort mapped](/assets/osimg/memory_mapped.png)

# 사이클 훔치기 (cycle stealing)
- CPU와 직접 메모리 접근이 동시에 메모리에 접근하면 보통 CPU가 메모리 사용 권한을 양보
- CPU의 작업 속도보다 입출력장치의 속도가 느리기 떄문에 직접 메모리 접근에 양보하는 것으로, 이러한 상황을 **사이클 훔치기**라고 함
